{% load static %}
<!DOCTYPE html>
<!-- saved from url=(0041)http://ds.newhorizonbio.com/qj_query.html -->
<html xmlns="http://www.w3.org/1999/xhtml" class="ui-mobile">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!--<base href="http://ds.newhorizonbio.com/qj_query.html">-->
    <base href=".">
    <title>取件查询</title>

    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <!--css-->
    <script src="{% static 'js/commonCss.js' %}" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'css/jquery.mobile.structure-1.4.5.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/common.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/nhapp.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/nhicofont.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/iscrollAutoCreat.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/mobiscroll-2.11.1.full.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/photoswipe.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/default-skin.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/mobile-select-area.css' %}">

    <!--js-->
    <script src="{% static 'js/commonJs.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/jquery-2.1.0.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/jquery.mobile-1.4.3.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/mobile.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/common.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/jquery.lazyload.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/swipe.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/jquery.validate.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/jquery.validate.addMethod.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/photoswipe.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/photoswipe-ui-default.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/creatPhotoswipe.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/iscroll-probe.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/iscrollAutoCreat.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/mobiscroll-2.11.1.full.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/dialog.js' %}"></script>
    <script src="{% static 'js/mobile-select-area.js' %}"></script>
    <script src="{% static 'js/timeCountDown.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/jweixin-1.0.0.js' %}" type="text/javascript"></script>
    <style>

        .dList {

        }

        .dList li {
            width: 75%;
            margin: 0 auto;
            margin-top: 10px;
            background-color: #fff;
            padding: 5% 10% 5% 5%;
            position: relative;
            border-radius: 10px;
        }

        .dList li button {
            width: 40%;
            height: 32px;
            line-height: 16px;
            background: #fff;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 15px;
            /* margin: 0 auto; */
            /* position: absolute; */
            margin-left: 30%;
            margin-top: 20px;
        }

        /*.dList li:after {*/
        /*font-family: 'nhicofont';*/
        /*content: "\e949";*/
        /*display: block;*/
        /*position: absolute;*/
        /*right: 0.5em;*/
        /*top: 50%;*/
        /*margin-top: -0.5em;*/
        /*width: 1.5em;*/
        /*text-align: center;*/
        /*color: #999;*/
        /*line-height: 1;*/
        /*}*/
        .dList li p {
            margin-top: 10px;
            font-weight: bolder;
        }

        .dList li p b {
            font-weight: normal;
        }

        .mask {
            position: fixed;
            left: 0px;
            top: 0px;
            bottom: 0px;
            right: 0px;
            background: rgba(0, 0, 0, 0.5);
            width: 100%;
            height: 100%;
            z-Index: 9999;
            display: none;
        }

        .nh-list-show {
            width: 80%;
            height: auto;
            position: absolute;
            left: 10%;
            top: 15%;
        }

        .nh-list-tab {
            padding: 10%;
            background: #fff;
            min-height: 250px;
            max-height: 450px;
            overflow: auto;
        }

        .nh-list-show .close {
            position: absolute;
            right: 0px;
            padding: 10px;
            color: red;
            font-weight: bold;
        }

        .nh-list-show li {
            position: relative;
            border-bottom: 2px solid #f5f5f5;
            font-size: 0.875em;
            color: #666;
            padding-top: 5px;
        }

        .nh-list-show li p {
            line-height: 20px;
        }

        .nh-list-show li.first {
            color: #3eaf0e;
        }

        .nh-list-show li .after {
            position: absolute;
            left: -16px;
            top: 0.4em;
            width: 8px;
            height: 8px;
            background: #ddd;
            border-radius: 6px;
        }

        .nh-list-show li.first .after {
            background: #3eaf0e;
        }

        .nh-list-show li .before {
            position: absolute;
            left: -13px;
            top: 0px;
            height: 110%;
            width: 0;
            border-left: 2px solid #ddd;
        }

        .hiddenOverflow {
            overflow: hidden;
        }

        .jdLogo {
            /*width: 16px;*/
            /*height: 16px;*/
            /*display: inline-block;*/
            /*vertical-align: top;*/
            /*background: url("/common/imgs/express_bg.jpg") no-repeat;*/
            /*background-position: 0px -1504px;*/
            background: url("{% static 'images/qjst.png' %}") no-repeat;
            background-position: top 2px right 2px;
            background-size: 40%;

        }

        .sfLogo {
            /*width: 16px;*/
            /*height: 16px;*/
            /*display: inline-block;*/
            /*vertical-align: top;*/
            /*background: url("/common/imgs/express_bg.jpg") no-repeat;*/
            /*background-position: 0px -32px;*/
            background: url("{% static 'images/cxst.png' %}") no-repeat;
            background-position: top 2px right 2px;
            background-size: 25%;
        }
    </style>
</head>

<body class="ui-mobile-viewport ui-overlay-a">
<div data-role="page" id="order_query" data-url="order_query" data-external-page="false" tabindex="0"
     class="ui-page ui-page-theme-a ui-page-header-fixed ui-page-active" style="min-height: 844px; padding-top: 62px;">
    <div data-role="header" data-position="fixed" data-tap-toggle="false" role="banner"
         class="ui-header ui-header-fixed slidedown ui-bar-inherit">
        <h1 class="ui-title" role="heading" aria-level="1">取件查询</h1>
    </div>
    <div role="main" class="ui-content ui-content-full">
        <div class="wrap">
            <div class="mh-form-wrap" style="padding: 0 1em">
                <p>
                    <label></label>
                <div class="ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset ui-input-has-clear"><input
                        data-clear-btn="true" id="no" type="text" name="" placeholder="请输入手机号" value=""><a
                        href="http://ds.newhorizonbio.com/qj_query.html#"
                        class="ui-input-clear ui-btn ui-icon-delete ui-btn-icon-notext ui-corner-all"
                        title="Clear text">Clear text</a></div>
                </p>
                <p>
                    <button type="submit" id="bt" data-mini="true"
                            class="btn-blue j_Tap ui-btn ui-shadow ui-corner-all">查询
                    </button>
                </p>
                <!--<p style="display:none;font-weight: bolder" class="pTitle">您的手机号有如下订单！点击查看物流信息！</p>-->
            </div>
        </div>
        <ul class="dList" style=""></ul>
        <div class="mask">
            <div class="nh-list-show">
                <p class="close">×</p>
                <ul class="nh-list-tab nh-list-tab1">

                </ul>
            </div>
        </div>
    </div>

</div>
<script>
    $("#bt").click(function () {
        $('.dList').html("");
        var a = $("#no").val();
        if (a == "") {
            $setAlert('请输入手机号!');
            return;
        }
        $.ajax({
            type: "get",
            url: '/goodinfo/getQwdList/' + a,
            success: function (data) {
                console.log(data);
                $('.pTitle').show();
                var dHtml = '';
                for (var i = 0; i < data.length; i++) {
                    if (typeof (data[i].expressType) == "undefined" || data[i].expressType == "2") {
                        // dHtml+='</b><i class="jdLogo">&nbsp;&nbsp;&nbsp;&nbsp;</i></p>';
                        // dHtml+='<li onclick="detail(this)" class="jdLogo">';
                        dHtml += '<li><p>快递公司：<b>京东快递</b></p>';
                    } else if (data[i].expressType == "1") {
                        // dHtml+='</b><i class="sfLogo">&nbsp;&nbsp;&nbsp;&nbsp;</i></p>';
                        // dHtml+='<li onclick="detail(this)" class="sfLogo">';
                        dHtml += '<li><p>快递公司：<b>顺丰快递</b></p>';
                        if (typeof (data[i].sfOrderStateDesc) != "undefined") {
                            dHtml += '<p>订单状态：<b>' + data[i].sfOrderStateDesc + '</b></p>';
                        }
                        if (typeof (data[i].sfEmpPhone) != "undefined") {
                            dHtml += '<p>快递员手机号：<a style="font-weight: normal;" href="tel:' + data[i].sfEmpPhone + '">' + data[i].sfEmpPhone + ' </a></p>';
                        }
                    } else if (data[i].expressType == "3") {
                        dHtml += '<li><p>快递公司：<b>EMS快递</b></p>';
                        if (typeof (data[i].sfOrderStateDesc) != "undefined") {
                            dHtml += '<p>订单状态：<b>' + data[i].sfOrderStateDesc + '</b></p>';
                        } else {
                            dHtml += '<p>订单状态：<b>快递公司处理中...</b></p>';
                        }
                        if (typeof (data[i].sfEmpPhone) != "undefined") {
                            dHtml += '<p>快递员手机号：<a style="font-weight: normal;" href="tel:' + data[i].sfEmpPhone + '">' + data[i].sfEmpPhone + ' </a></p>';
                        }
                    }

                    if (typeof (data[i].expressNo) == "undefined" || data[i].expressNo == "null") {
                        dHtml += '<p class="qdh">取单号：<b>待取件后生成...</b></p>';
                    } else {
                        dHtml += '<p class="qdh">取单号：<b>' + data[i].expressNo + '</b></p>';
                    }
                    dHtml += '<p>下单时间：<b>' + data[i].createdTime + '</b></p><button onclick="detail(this)">查看物流路由</button></li>';
                }
                $('.dList').html(dHtml).show();
            }
        });
    });

    function detail(obj) {
        var b = $(obj).parent("li").children(".qdh").children('b').text();
        var url = "/goodinfo/getQwdDetail/" + b;
        if (b.startsWith("SF")) {
            var phoneNumber = $("#no").val();
            var tailNumber = phoneNumber.substr(phoneNumber.length - 4, 4);
            url = "/sfExpressForSdt/getSfDetail/" + b + "/" + tailNumber;
        } else if (b.startsWith("QWD") || b.startsWith("JDVB")) {
            url = "/goodinfo/getQwdDetail/" + b;
        } else {
            url = "/nEmsExpress/getNewEmsDetail/" + b;
        }
        $.ajax({
            type: "get",
            url: url,
            success: function (data) {
                console.log("ssssssssssssss:" + data)
                if (data == '') {
                    $setAlert('该运单暂无物流跟踪信息')
                } else {
                    $(".mask").show();
                    document.body.classList.add("hiddenOverflow");
                    var sendHtml = '';
                    for (var i = data.length - 1; i >= 0; i--) {
                        if (b.startsWith("SF")) {
                            var acceptAddress = data[i].acceptAddress;
                            var acceptTime = data[i].acceptTime;
                            var remark = data[i].remark;
                            var phoneStr = matchPhoneNum(remark);
                            if (i == (data.length - 1)) {
                                sendHtml += '<li class="first"><p><a style="font-weight: bolder;">' + acceptAddress + '</a>' + '&nbsp;&nbsp;' + acceptTime + '</p>';
                            } else {
                                sendHtml += '<li><p><a style="font-weight: bolder;">' + acceptAddress + '</a>' + '&nbsp;&nbsp;' + acceptTime + '</p>';
                            }
                            if (phoneStr) {
                                sendHtml += '<p>' + phoneStr + '</p>';
                            } else {
                                sendHtml += '<p>' + remark + '</p>';
                            }
                        } else if (b.startsWith("QWD") || b.startsWith("JDVB")) {
                            var dataMark = data[i].opeRemark;
                            var strresult = matchPhoneNum(dataMark);
                            if (i == (data.length - 1)) {
                                sendHtml += '<li class="first"><p><a style="font-weight: bolder;">' + data[i].opeTitle + '</a>' + '&nbsp;&nbsp;' + data[i].opeTime + '</p>';
                            } else {
                                sendHtml += '<li><p><a style="font-weight: bolder;">' + data[i].opeTitle + '</a>' + '&nbsp;&nbsp;' + data[i].opeTime + '</p>';
                            }
                            if (strresult) {
                                sendHtml += '<p>' + strresult + '</p>';
                            } else {
                                sendHtml += '<p>' + data[i].opeRemark + '</p>';
                            }
                        } else {
                            var opName = data[i].opName;
                            var opTime = data[i].opTime;
                            var opOrgCity = data[i].opOrgCity;
                            var opDesc = data[i].opDesc;
                            var phoneStr = matchPhoneNum(opDesc);
                            if (i == (data.length - 1)) {
                                sendHtml += '<li class="first"><p><a style="font-weight: bolder;">' + opName + '</a>' + '&nbsp;&nbsp;' + opTime + '</p>';
                            } else {
                                sendHtml += '<li><p><a style="font-weight: bolder;">' + opName + '</a>' + '&nbsp;&nbsp;' + opTime + '</p>';
                            }
                            if (phoneStr) {
                                sendHtml += opOrgCity == '' ? '<p>' + phoneStr + '</p>' : '<p>【' + opOrgCity + "】" + phoneStr + '</p>';
                            } else {
                                sendHtml += opOrgCity == '' ? '<p>' + opDesc + '</p>' : '<p>【' + opOrgCity + "】" + opDesc + '</p>';
                            }
                        }
                        if (i >= 0) {
                            sendHtml += '<span class="before"></span><span class="after"></span></li>';
                        }
                    }
                    $(".nh-list-tab").html(sendHtml);
                }
            }
        });
    }

    $(".close").click(function () {
        $(".mask").hide();
        document.body.classList.remove("hiddenOverflow");
    });
    <!--微信分享p配置-->
    var shareUrl = location.href;
    var product = "诺辉健康取件查询";

    var shareImg = "http://ds.newhorizonbio.com/common/imgs/wxShare/qjcx.jpg";
    var shareText = "点击链接可查询您的寄件信息及物流单号";

    getWxConfig(function (cfg) {
        wx.config({
            debug: false,
            appId: cfg.appid,
            timestamp: cfg.timestamp,//生成签名的时间戳
            nonceStr: cfg.nonceStr,//生成签名的随机字符串
            signature: cfg.signature,//签名
            jsApiList: [//需要调用的JS接口列表
                'checkJsApi',//判断当前客户端版本是否支持指定JS接口
                'onMenuShareTimeline',//分享给好友
                'onMenuShareAppMessage',//分享到朋友圈
                'onMenuShareQQ'//分享到qq
            ]
        });
        wx.ready(function () {
            wx.onMenuShareTimeline({ //分享到朋友圈
                title: product, // 分享标题
                desc: shareText,
                link: shareUrl, // 分享链接
                imgUrl: shareImg, // 分享图标
                success: function () {
                    // 用户确认分享后执行的回调函数
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });
            wx.onMenuShareAppMessage({ //分享给朋友
                title: product, // 分享标题
                desc: shareText, // 分享描述
                link: shareUrl, // 分享链接
                imgUrl: shareImg, // 分享图标
                type: 'link', // 分享类型,music、video或link，不填默认为link
                dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                success: function () {
                    // 用户确认分享后执行的回调函数
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });
            wx.onMenuShareQQ({  //分享到QQ
                title: product, // 分享标题
                desc: shareText, // 分享描述
                link: shareUrl, // 分享链接
                imgUrl: shareImg, // 分享图标
                success: function () {
                    // 用户确认分享后执行的回调函数
                },
                cancel: function () {
                    // 用户取消分享后执行的回调函数
                }
            });

        });
    });

    function getWxConfig(callback) {
        var url = navigator.userAgent.indexOf('Android') > 0 ? location.href.split('#')[0] : location.href;
        if (!url) return;
        $.ajax({
            data: {url: url},
            url: '/wx/wechatParam',
            type: "get",
            dataType: "json",
            async: false,
            success: function (data) {
                callback(data);
            }
        });
    }

    function matchPhoneNum(str) {
        console.log('str' + str);
        var phoneNums = str.match(/(1[3|4|5|7|8][\d]{9}|0[\d]{2,3}-[\d]{7,8}|400[-]?[\d]{3}[-]?[\d]{4})/g);
        console.log('phoneNums' + phoneNums);
        if (phoneNums != null) {
            for (var i = 0; i < phoneNums.length; i++) {
                str = str.replace(phoneNums[i], '<a style="color:red" href="tel:' + phoneNums[i] + '">' + phoneNums[i] + '</a>');
            }
            return str;
        }
    }
</script>


<div class="ui-loader ui-corner-all ui-body-a ui-loader-default"><span class="ui-icon-loading"></span>
    <h1>loading</h1></div>
</body>
</html>